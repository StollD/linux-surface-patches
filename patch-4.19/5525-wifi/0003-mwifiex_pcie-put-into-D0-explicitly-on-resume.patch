From 9c9605de53468be901f7465c481829660d1143be Mon Sep 17 00:00:00 2001
From: kitakar5525 <34676735+kitakar5525@users.noreply.github.com>
Date: Wed, 14 Aug 2019 09:28:58 +0900
Subject: [PATCH] mwifiex_pcie: put into D0 explicitly on resume

---
 drivers/net/wireless/marvell/mwifiex/pcie.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/net/wireless/marvell/mwifiex/pcie.c b/drivers/net/wireless/marvell/mwifiex/pcie.c
index 2bf067138..6eee79d66 100644
--- a/drivers/net/wireless/marvell/mwifiex/pcie.c
+++ b/drivers/net/wireless/marvell/mwifiex/pcie.c
@@ -18,6 +18,7 @@
  */
 
 #include <linux/firmware.h>
+#include <linux/suspend.h>
 
 #include "decl.h"
 #include "ioctl.h"
@@ -200,6 +201,10 @@ static int mwifiex_pcie_resume(struct device *dev)
 
 	card = pci_get_drvdata(pdev);
 
+	/* put into D0 */
+	pr_info("DEBUG: putting into D0...\n");
+	pci_set_power_state(pdev, PCI_D0);
+
 	if (!card->adapter) {
 		dev_err(dev, "adapter structure is not valid\n");
 		return 0;
-- 
2.22.0

